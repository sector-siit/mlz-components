name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
    paths:
      - "src/**"
      - "package.json"
      - "tsconfig.json"
      - "tailwind.config.js"
      - "rollup.config.js"
      - "postcss.config.cjs"
      - ".storybook/**"
      - "eslint.config.js"
      - "bunfig.toml"
      - ".github/workflows/**"
      - ".releaserc.json"
      - "commitlint.config.cjs"
  pull_request:
    branches: [main, develop]
    paths:
      - "src/**"
      - "package.json"
      - "tsconfig.json"
      - "tailwind.config.js"
      - "rollup.config.js"
      - "postcss.config.cjs"
      - ".storybook/**"
      - "eslint.config.js"
      - "bunfig.toml"
      - ".github/workflows/**"
      - ".releaserc.json"
      - "commitlint.config.cjs"

jobs:
  # Validaci√≥n de commits - se ejecuta siempre
  validate-commits:
    name: ‚úÖ Validate Commits
    uses: ./.github/workflows/validate-commits.yml

  # Job principal de build y testing
  build-and-test:
    name: ÔøΩ Build & Test
    needs: validate-commits
    uses: ./.github/workflows/build.yml

  # Semantic Release - maneja todo autom√°ticamente
  semantic-release:
    name: üöÄ Semantic Release
    if: github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop')
    needs: [validate-commits, build-and-test]
    uses: ./.github/workflows/semantic-release.yml
    secrets:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}

  # Update badges en todos los casos
  update-badges:
    name: üè∑Ô∏è Update Badges
    needs: build-and-test
    uses: ./.github/workflows/update-badges.yml
    uses: ./.github/workflows/release-candidate.yml
    secrets:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
