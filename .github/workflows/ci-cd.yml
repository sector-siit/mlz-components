name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
    paths:
      - "src/**"
      - "package.json"
      - "tsconfig.json"
      - "tailwind.config.js"
      - "rollup.config.js"
      - "postcss.config.cjs"
      - ".storybook/**"
      - "eslint.config.js"
      - "bunfig.toml"
      - ".github/workflows/**"
  pull_request:
    branches: [main, develop]
    paths:
      - "src/**"
      - "package.json"
      - "tsconfig.json"
      - "tailwind.config.js"
      - "rollup.config.js"
      - "postcss.config.cjs"
      - ".storybook/**"
      - "eslint.config.js"
      - "bunfig.toml"
      - ".github/workflows/**"

jobs:
  # Job principal de build y testing
  build-and-test:
    name: ğŸ”¨ Build & Test
    uses: ./.github/workflows/build.yml

  # Deploy Storybook solo en main
  deploy-storybook:
    name: ğŸ“š Deploy Storybook
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    needs: build-and-test
    uses: ./.github/workflows/deploy-storybook.yml

  # Update badges en todos los casos
  update-badges:
    name: ğŸ·ï¸ Update Badges
    needs: build-and-test
    uses: ./.github/workflows/update-badges.yml

  # Release Candidate solo en develop
  release-candidate:
    name: ğŸ§ª Release Candidate
    if: github.ref == 'refs/heads/develop' && github.event_name == 'push'
    needs: build-and-test
    uses: ./.github/workflows/release-candidate.yml
    secrets:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
