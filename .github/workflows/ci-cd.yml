name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
    paths:
      - "src/**"
      - "package.json"
      - "tsconfig.json"
      - "tailwind.config.js"
      - "rollup.config.js"
      - "postcss.config.cjs"
      - ".storybook/**"
      - "eslint.config.js"
      - "bunfig.toml"
      - ".github/workflows/**"
  pull_request:
    branches: [main, develop]
    paths:
      - "src/**"
      - "package.json"
      - "tsconfig.json"
      - "tailwind.config.js"
      - "rollup.config.js"
      - "postcss.config.cjs"
      - ".storybook/**"
      - "eslint.config.js"
      - "bunfig.toml"
      - ".github/workflows/**"

jobs:
  # Job principal de build y testing
  build-and-test:
    name: ðŸ”¨ Build & Test
    uses: ./.github/workflows/build.yml
    
  # Deploy Storybook solo en main
  deploy-storybook:
    name: ðŸ“š Deploy Storybook
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    needs: build-and-test
    uses: ./.github/workflows/deploy-storybook.yml
    
  # Publish to NPM solo en main si la versiÃ³n cambiÃ³
  publish-npm:
    name: ðŸ“¦ Publish to NPM
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    needs: build-and-test
    uses: ./.github/workflows/publish-npm.yml
    secrets:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
    
  # Create release solo en main despuÃ©s de publicar
  create-release:
    name: ðŸš€ Create Release
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    needs: [build-and-test, publish-npm]
    uses: ./.github/workflows/create-release.yml
    
  # Release Candidate solo en develop
  release-candidate:
    name: ðŸ§ª Release Candidate
    if: github.ref == 'refs/heads/develop' && github.event_name == 'push'
    needs: build-and-test
    uses: ./.github/workflows/release-candidate.yml
    secrets:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
